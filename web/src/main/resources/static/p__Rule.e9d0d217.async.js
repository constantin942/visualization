(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[835],{37476:function(se,X,e){"use strict";e.d(X,{Y:function(){return k}});var B=e(71194),_=e(50146),ne=e(22122),o=e(87757),s=e.n(o),m=e(92137),b=e(28991),q=e(28481),ee=e(84305),oe=e(75901),w=e(81253),d=e(67294),W=e(21770),ae=e(73935),O=e(24214),j=e(80334),z=e(82492),u=e.n(z),Z=["children","trigger","onVisibleChange","modalProps","onFinish","submitTimeout","title","width","visible"];function k(v){var J,S,x,I,$=v.children,F=v.trigger,n=v.onVisibleChange,t=v.modalProps,i=v.onFinish,a=v.submitTimeout,r=v.title,H=v.width,L=v.visible,C=(0,w.Z)(v,Z);(0,j.ET)(!C.footer||!(t==null?void 0:t.footer),"ModalForm \u662F\u4E00\u4E2A ProForm \u7684\u7279\u6B8A\u5E03\u5C40\uFF0C\u5982\u679C\u60F3\u81EA\u5B9A\u4E49\u6309\u94AE\uFF0C\u8BF7\u4F7F\u7528 submit.render \u81EA\u5B9A\u4E49\u3002");var K=(0,d.useContext)(oe.ZP.ConfigContext),te=(0,d.useState)([]),G=(0,q.Z)(te,2),re=G[1],ue=(0,d.useState)(!1),Q=(0,q.Z)(ue,2),V=Q[0],N=Q[1],ie=(0,W.Z)(!!L,{value:L,onChange:n}),Y=(0,q.Z)(ie,2),p=Y[0],M=Y[1],E=(0,d.useRef)(null),D=(0,d.useCallback)(function(c){E.current===null&&c&&re([]),E.current=c},[]);(0,d.useEffect)(function(){p&&L&&(n==null||n(!0))},[L,p]);var P=(0,d.useMemo)(function(){return F?d.cloneElement(F,(0,b.Z)((0,b.Z)({key:"trigger"},F.props),{},{onClick:function(){var c=(0,m.Z)(s().mark(function g(T){var R,U;return s().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:M(!p),(R=F.props)===null||R===void 0||(U=R.onClick)===null||U===void 0||U.call(R,T);case 2:case"end":return y.stop()}},g)}));function f(g){return c.apply(this,arguments)}return f}()})):null},[M,F,p]),l=(0,d.useMemo)(function(){var c,f,g,T,R,U,le,y;return C.submitter===!1?!1:u()({searchConfig:{submitText:(c=(f=t==null?void 0:t.okText)!==null&&f!==void 0?f:(g=K.locale)===null||g===void 0||(T=g.Modal)===null||T===void 0?void 0:T.okText)!==null&&c!==void 0?c:"\u786E\u8BA4",resetText:(R=(U=t==null?void 0:t.cancelText)!==null&&U!==void 0?U:(le=K.locale)===null||le===void 0||(y=le.Modal)===null||y===void 0?void 0:y.cancelText)!==null&&R!==void 0?R:"\u53D6\u6D88"},resetButtonProps:{preventDefault:!0,disabled:a?V:void 0,onClick:function(ce){var de;M(!1),t==null||(de=t.onCancel)===null||de===void 0||de.call(t,ce)}}},C.submitter)},[(J=K.locale)===null||J===void 0||(S=J.Modal)===null||S===void 0?void 0:S.cancelText,(x=K.locale)===null||x===void 0||(I=x.Modal)===null||I===void 0?void 0:I.okText,t,C.submitter,M,V,a]),A=(0,d.useCallback)(function(c,f){return d.createElement(d.Fragment,null,c,E.current&&f?(0,ae.createPortal)(f,E.current):f)},[]),h=(0,d.useCallback)(function(){var c=(0,m.Z)(s().mark(function f(g){var T,R,U;return s().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return T=i==null?void 0:i(g),a&&T instanceof Promise&&(N(!0),R=setTimeout(function(){return N(!1)},a),T.finally(function(){clearTimeout(R),N(!1)})),y.next=4,T;case 4:U=y.sent,U&&M(!1);case 6:case"end":return y.stop()}},f)}));return function(f){return c.apply(this,arguments)}}(),[i,M,a]);return d.createElement(d.Fragment,null,d.createElement(_.Z,(0,ne.Z)({title:r,width:H||800},t,{visible:p,onCancel:function(f){var g;a&&V||(M(!1),t==null||(g=t.onCancel)===null||g===void 0||g.call(t,f))},footer:C.submitter!==!1&&d.createElement("div",{ref:D,style:{display:"flex",justifyContent:"flex-end"}})}),d.createElement(O.I,(0,ne.Z)({formComponentType:"ModalForm",layout:"vertical"},C,{submitter:l,onFinish:h,contentRender:A}),$)),P)}},20294:function(se){se.exports={rule:"rule___2uB8V",formContent:"formContent___mfpUm",cardContent:"cardContent___ADntJ",ruleDescDetail:"ruleDescDetail___2wYEk"}},58541:function(se,X,e){"use strict";e.r(X),e.d(X,{default:function(){return n}});var B=e(57663),_=e(71577),ne=e(71153),o=e(60331),s=e(2824),m=e(67294),b=e(59975),q=e(74379),ee=e(38648),oe=e(3182),w=e(86582),d=e(94043),W=e.n(d),ae=e(37476),O=e(64317),j=e(89460),z=e(13312),u=e(85893),Z="user_visited_time",k="user_visited_table";function v(t,i){var a=(0,m.useRef)(),r=(0,m.useState)(!1),H=(0,s.Z)(r,2),L=H[0],C=H[1],K=(0,m.useState)([]),te=(0,s.Z)(K,2),G=te[0],re=te[1],ue=(0,m.useState)(),Q=(0,s.Z)(ue,2),V=Q[0],N=Q[1],ie=(0,m.useState)(""),Y=(0,s.Z)(ie,2),p=Y[0],M=Y[1];return(0,m.useImperativeHandle)(i,function(){return{setInitValues:function(D,P){var l=D.split(",");(0,b.CZ)().then(function(A){N(A.data),l.forEach(function(h){(0,b.hQ)({typeName:h}).then(function(c){var f,g=c.data;re(function(T){return[].concat((0,w.Z)(T),[g])}),M(P),C(!0),(f=a.current)===null||f===void 0||f.setFieldsValue(A.data)})})})}}}),(0,u.jsxs)(ae.Y,{title:"\u4FEE\u6539\u89C4\u5219",layout:"horizontal",formRef:a,visible:L,onVisibleChange:C,width:350,labelAlign:"right",labelCol:{span:12},modalProps:{destroyOnClose:!0,onCancel:function(){return t.setVisible(!1)}},onFinish:function(){var E=(0,oe.Z)(W().mark(function D(P){var l;return W().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:l=Object.assign(V,P),delete l.id,(0,b._m)(l).then(function(c){var f=c.code;f===z.Gh&&(ee.Z.success({message:"\u63D0\u793A",description:"\u4FEE\u6539\u6210\u529F\uFF01"}),C(!1))});case 3:case"end":return h.stop()}},D)}));return function(D){return E.apply(this,arguments)}}(),children:[p===k&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(j.A.Group,{children:(0,u.jsx)(O.Z,{width:"sm",name:"ruleTableCount",label:"\u8BBF\u95EE\u6B21\u6570\u6700\u5C0F\u9608\u503C",options:G[0],tooltip:"\u4F4E\u4E8E\u6307\u5B9A\u6B21\u6570\u5C06\u88AB\u7B97\u4E3A\u5F02\u5E38",placeholder:"\u8BF7\u8F93\u5165\u8FB9\u754C\u6B21\u6570"})}),(0,u.jsx)(j.A.Group,{children:(0,u.jsx)(O.Z,{width:"sm",name:"ruleTablePeriod",label:"\u7EDF\u8BA1\u5468\u671F\uFF08\u5929\uFF09",options:G[1],tooltip:"\u8D85\u8FC7\u7EDF\u8BA1\u5468\u671F\u7684\u8BBF\u95EE\u884C\u4E3A\u5C06\u4E0D\u4F1A\u5F71\u54CD\u753B\u50CF",placeholder:"\u8BF7\u9009\u62E9\u7EDF\u8BA1\u5468\u671F"})})]}),p===Z&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(j.A.Group,{children:(0,u.jsx)(O.Z,{width:"sm",name:"ruleTimeRate",label:"\u8BBF\u95EE\u9891\u7387\u6700\u5C0F\u9608\u503C",options:G[0],tooltip:"\u4F4E\u4E8E\u9608\u503C\u5C06\u88AB\u89C6\u4E3A\u4E0D\u5E38\u8BBF\u95EE\u7684\u6570\u636E\u8868",placeholder:"\u8BF7\u8F93\u5165\u8FB9\u754C\u9891\u7387"})}),(0,u.jsx)(j.A.Group,{children:(0,u.jsx)(O.Z,{width:"sm",name:"ruleTimePeriod",label:"\u7EDF\u8BA1\u5468\u671F\uFF08\u5929\uFF09",options:G[1],tooltip:"\u8D85\u8FC7\u7EDF\u8BA1\u5468\u671F\u7684\u8BBF\u95EE\u884C\u4E3A\u5C06\u4E0D\u4F1A\u5F71\u54CD\u753B\u50CF",placeholder:"\u8BF7\u9009\u62E9\u7EDF\u8BA1\u5468\u671F"})})]})]})}var J=(0,m.forwardRef)(v),S=e(29474),x=e(25377),I=e(20294),$=e.n(I),F=function(){var i=(0,m.useState)([]),a=(0,s.Z)(i,2),r=a[0],H=a[1],L=(0,m.useState)(0),C=(0,s.Z)(L,2),K=C[0],te=C[1],G=(0,m.useState)(!1),re=(0,s.Z)(G,2),ue=re[0],Q=re[1],V=(0,m.useRef)(),N=(0,x.md)(),ie=(0,m.useState)({pageNo:1,pageSize:20}),Y=(0,s.Z)(ie,2),p=Y[0],M=Y[1],E=(0,m.useCallback)(function(D){(0,b.$D)(D).then(function(P){var l=P.data;if(l){var A=JSON.parse(l);te(A.total);var h=JSON.parse(A.rows);h.length>0?H(h):H([])}})},[]);return(0,m.useEffect)(function(){E(p)},[E,p]),(0,u.jsxs)("div",{className:$().rule,children:[(0,u.jsx)(S.ZP,{pagination:{total:K,pageSize:p.pageSize,current:p.pageNo,defaultPageSize:8,showSizeChanger:!1,onChange:function(P,l){M({pageSize:l,pageNo:P}),E({pageNo:P,pageSize:l})}},rowKey:"id",rowSelection:!1,grid:{gutter:16,column:2},metas:{title:{dataIndex:"ruleDesc"},subTitle:{render:function(P,l){return[(0,u.jsx)(o.Z,{color:l.isDelete===1?"#f50":"#87d068",children:l.isDelete===1?"\u5DF2\u7981\u7528":"\u542F\u7528\u4E2D"},"tag")]}},type:{dataIndex:"gmtCreate"},content:{dataIndex:"ruleDesc",render:function(P,l){return(0,u.jsxs)("div",{className:$().cardContent,children:[(0,u.jsxs)("div",{className:$().ruleDescDetail,children:["\u521B\u5EFA\u65F6\u95F4\uFF1A",l.gmtCreate]},"ruleDesc"),(0,u.jsx)("div",{className:$().ruleDescDetail,children:l.ruleDescDetail},"ruleDescDetail")]})}},actions:{render:function(P,l){return[(0,u.jsx)(x.Nv,{accessible:N.canUpdate,children:(0,u.jsx)(_.Z,{danger:l.isDelete===0,size:"small",type:"link",onClick:function(){(0,b.Y3)({ruleId:l.id,isDelete:l.isDelete===0?1:0}).then(function(){return E(p)})},children:l.isDelete===1?"\u542F\u7528":"\u7981\u7528"})},"isDelete"),(0,u.jsx)(x.Nv,{accessible:N.canUpdate,children:(0,u.jsx)(_.Z,{size:"small",type:"link",onClick:function(){if(k===l.ruleName){var h;(h=V.current)===null||h===void 0||h.setInitValues("rule_table_count,rule_table_period",k)}else if(Z===l.ruleName){var c;(c=V.current)===null||c===void 0||c.setInitValues("rule_time_rate,rule_time_period",Z)}},children:"\u4FEE\u6539"})},"update")]}}},headerTitle:"\u753B\u50CF\u89C4\u5219\u5217\u8868",dataSource:r}),(0,u.jsx)(J,{ref:V,refresh:function(){return E(p)},setVisible:Q,visible:ue})]})},n=F},59975:function(se,X,e){"use strict";e.d(X,{f2:function(){return q},MN:function(){return d},yb:function(){return ae},ny:function(){return j},$D:function(){return u},Y3:function(){return k},hQ:function(){return J},CZ:function(){return x},_m:function(){return $}});var B=e(11849),_=e(3182),ne=e(94043),o=e.n(ne),s=e(25377),m=e(80129),b=e.n(m);function q(n,t){return ee.apply(this,arguments)}function ee(){return ee=(0,_.Z)(o().mark(function n(t,i){return o().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,s.WY)("/api/skyflying/addUserPortraitByVisitedTableEverydayRule",(0,B.Z)({method:"GET",params:t},i||{})));case 1:case"end":return r.stop()}},n)})),ee.apply(this,arguments)}function oe(n){return w.apply(this,arguments)}function w(){return w=_asyncToGenerator(_regeneratorRuntime.mark(function n(t){return _regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",request("/api/skyflying/updateUserPortraitByVisitedTimeRule",_objectSpread({method:"GET"},t||{})));case 1:case"end":return a.stop()}},n)})),w.apply(this,arguments)}function d(n,t){return W.apply(this,arguments)}function W(){return W=(0,_.Z)(o().mark(function n(t,i){return o().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,s.WY)("/api/skyflying/addUserPortraitByVisitedTtimeRule",(0,B.Z)({method:"GET",params:t},i||{})));case 1:case"end":return r.stop()}},n)})),W.apply(this,arguments)}function ae(n,t){return O.apply(this,arguments)}function O(){return O=(0,_.Z)(o().mark(function n(t,i){return o().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,s.WY)("/api/skyflying/updateUserPortraitByVisitedTimeRule",(0,B.Z)({method:"GET",params:t},i||{})));case 1:case"end":return r.stop()}},n)})),O.apply(this,arguments)}function j(n,t){return z.apply(this,arguments)}function z(){return z=(0,_.Z)(o().mark(function n(t,i){return o().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,s.WY)("/api/skyflying/updateUserPortraitByVisitedTableEverydayRule",(0,B.Z)({method:"GET",params:t},i||{})));case 1:case"end":return r.stop()}},n)})),z.apply(this,arguments)}function u(n,t){return Z.apply(this,arguments)}function Z(){return Z=(0,_.Z)(o().mark(function n(t,i){return o().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,s.WY)("/api/skyflying/getUserPortraitRules",(0,B.Z)({method:"GET",params:t},i||{})));case 1:case"end":return r.stop()}},n)})),Z.apply(this,arguments)}function k(n,t){return v.apply(this,arguments)}function v(){return v=(0,_.Z)(o().mark(function n(t,i){return o().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,s.WY)("/api/skyflying/updateUserPortraitRule?"+b().stringify(t),(0,B.Z)({method:"POST"},i||{})));case 1:case"end":return r.stop()}},n)})),v.apply(this,arguments)}function J(n,t){return S.apply(this,arguments)}function S(){return S=(0,_.Z)(o().mark(function n(t,i){return o().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,s.WY)("/api/skyflying/config/getConfigDic",(0,B.Z)({method:"GET",params:t||{}},i||{})));case 1:case"end":return r.stop()}},n)})),S.apply(this,arguments)}function x(n){return I.apply(this,arguments)}function I(){return I=(0,_.Z)(o().mark(function n(t){return o().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.WY)("/api/skyflying/config/getPortraitConfig",(0,B.Z)({method:"GET"},t||{})));case 1:case"end":return a.stop()}},n)})),I.apply(this,arguments)}function $(n,t){return F.apply(this,arguments)}function F(){return F=(0,_.Z)(o().mark(function n(t,i){return o().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,s.WY)("/api/skyflying/config/updatePortraitConfig",(0,B.Z)({method:"PUT",data:t},i||{})));case 1:case"end":return r.stop()}},n)})),F.apply(this,arguments)}}}]);
