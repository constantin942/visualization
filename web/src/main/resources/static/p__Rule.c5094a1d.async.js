(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[835],{20294:function(re){re.exports={rule:"rule___2uB8V",formContent:"formContent___mfpUm",cardContent:"cardContent___ADntJ",ruleDescDetail:"ruleDescDetail___2wYEk",highRisk:"highRisk___3vyHc"}},58541:function(re,z,t){"use strict";t.r(z),t.d(z,{default:function(){return r}});var E=t(77576),f=t(12028),_=t(11849),o=t(57663),p=t(71577),fe=t(71153),ae=t(60331),C=t(2824),d=t(67294),B=t(59975),J=t(74379),ne=t(38648),N=t(3182),se=t(32059),I=t(94043),Q=t.n(I),w=t(37476),x=t(64317),Z=t(89460),G=t(13312),S=t(24480),u=t(85893),A="user_visited_time",j="user_visited_table";function M(n,l){var s=(0,d.useRef)(),e=(0,d.useState)(!1),H=(0,C.Z)(e,2),le=H[0],V=H[1],oe=(0,d.useState)({}),X=(0,C.Z)(oe,2),R=X[0],L=X[1],m=(0,d.useState)(),q=(0,C.Z)(m,2),de=q[0],ee=q[1],ce=(0,d.useState)(""),ue=(0,C.Z)(ce,2),O=ue[0],te=ue[1];return(0,d.useImperativeHandle)(l,function(){return{setInitValues:function(T,P){L({});var D=T.split(",");(0,B.CZ)().then(function(c){ee(c.data),D.forEach(function(h){(0,B.hQ)({typeName:h}).then(function(v){var a,i,F=v.data,g=F.some(function(b){return parseFloat(b)<1}),k=[];g&&(k=F.map(function(b){return{id:S.Z.uuid(),label:"".concat(parseFloat(b)*100," %"),value:b}})),te(P),L(function(b){return(0,_.Z)((0,_.Z)({},b),{},(0,se.Z)({},h,g?k:F))}),V(!0),(a=s.current)===null||a===void 0||a.setFieldsValue({ruleTableCount:c.data.ruleTableCount,ruleTablePeriod:c.data.ruleTablePeriod,ruleTimeRate:"".concat(parseFloat(c==null||(i=c.data)===null||i===void 0?void 0:i.ruleTimeRate)*100," %"),ruleTimePeriod:c.data.ruleTimePeriod})})})})}}}),(0,u.jsxs)(w.Y,{title:"\u4FEE\u6539\u89C4\u5219",layout:"horizontal",formRef:s,visible:le,onVisibleChange:V,width:350,labelAlign:"right",labelCol:{span:12},modalProps:{destroyOnClose:!1,onCancel:function(){var T;(T=s.current)===null||T===void 0||T.resetFields(),n.setVisible(!1)}},onFinish:function(){var K=(0,N.Z)(Q().mark(function T(P){var D,c,h,v;return Q().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:c=Object.assign(de,P),typeof c.ruleTimeRate=="string"&&(D=c.ruleTimeRate)!==null&&D!==void 0&&D.includes("%")&&(v=(h=c.ruleTimeRate)===null||h===void 0?void 0:h.replace("%",""),c.ruleTimeRate=parseFloat(v)/100+""),delete c.id,(0,B._m)(c).then(function(F){var g=F.code;g===G.Gh&&(ne.Z.success({message:"\u63D0\u793A",description:"\u4FEE\u6539\u6210\u529F\uFF01"}),V(!1),n.refresh())});case 4:case"end":return i.stop()}},T)}));return function(T){return K.apply(this,arguments)}}(),children:[O===j&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(Z.A.Group,{children:(0,u.jsx)(x.Z,{rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u8BBF\u95EE\u6B21\u6570\u6700\u5C0F\u9608\u503C\uFF01"}],width:"sm",name:"ruleTableCount",label:"\u8BBF\u95EE\u6B21\u6570\u6700\u5C0F\u9608\u503C",options:R==null?void 0:R.rule_table_count,tooltip:"\u4F4E\u4E8E\u6307\u5B9A\u6B21\u6570\u5C06\u88AB\u7B97\u4E3A\u5F02\u5E38",placeholder:"\u8BF7\u8F93\u5165\u8FB9\u754C\u6B21\u6570"})}),(0,u.jsx)(Z.A.Group,{children:(0,u.jsx)(x.Z,{rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u8BBF\u7EDF\u8BA1\u5468\u671F\uFF01"}],width:"sm",name:"ruleTablePeriod",label:"\u7EDF\u8BA1\u5468\u671F\uFF08\u5929\uFF09",options:R==null?void 0:R.rule_table_period,tooltip:"\u8D85\u8FC7\u7EDF\u8BA1\u5468\u671F\u7684\u8BBF\u95EE\u884C\u4E3A\u5C06\u4E0D\u4F1A\u5F71\u54CD\u753B\u50CF",placeholder:"\u8BF7\u9009\u62E9\u7EDF\u8BA1\u5468\u671F"})})]}),O===A&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(Z.A.Group,{children:(0,u.jsx)(x.Z,{rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u8BBF\u95EE\u9891\u7387\u6700\u5C0F\u9608\u503C\uFF01"}],width:"sm",name:"ruleTimeRate",label:"\u8BBF\u95EE\u9891\u7387\u6700\u5C0F\u9608\u503C",options:R.rule_time_rate,tooltip:"\u4F4E\u4E8E\u9608\u503C\u5C06\u88AB\u89C6\u4E3A\u4E0D\u5E38\u8BBF\u95EE\u7684\u6570\u636E\u8868",placeholder:"\u8BF7\u8F93\u5165\u8FB9\u754C\u9891\u7387"})}),(0,u.jsx)(Z.A.Group,{children:(0,u.jsx)(x.Z,{rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u8BBF\u7EDF\u8BA1\u5468\u671F\uFF01"}],width:"sm",name:"ruleTimePeriod",label:"\u7EDF\u8BA1\u5468\u671F\uFF08\u5929\uFF09",filedConfig:{},options:R.rule_time_period,tooltip:"\u8D85\u8FC7\u7EDF\u8BA1\u5468\u671F\u7684\u8BBF\u95EE\u884C\u4E3A\u5C06\u4E0D\u4F1A\u5F71\u54CD\u753B\u50CF",placeholder:"\u8BF7\u9009\u62E9\u7EDF\u8BA1\u5468\u671F"})})]})]})}var ie=(0,d.forwardRef)(M),U=t(29474),W=t(25377),Y=t(20294),y=t.n(Y),$=function(){var l=(0,d.useState)([]),s=(0,C.Z)(l,2),e=s[0],H=s[1],le=(0,d.useState)(!1),V=(0,C.Z)(le,2),oe=V[0],X=V[1],R=(0,d.useState)(),L=(0,C.Z)(R,2),m=L[0],q=L[1],de=(0,d.useState)([]),ee=(0,C.Z)(de,2),ce=ee[0],ue=ee[1],O=(0,d.useRef)(),te=(0,W.md)(),K=(0,d.useState)({pageNo:1,pageSize:20}),T=(0,C.Z)(K,1),P=T[0],D=(0,d.useCallback)(function(h){(0,B.$D)(h).then(function(v){var a=v.data;if(a){var i=JSON.parse(a),F=JSON.parse(i.rows);F.length>0?H(F):H([])}}),(0,B.MY)().then(function(v){var a=v.data;Array.isArray(a)&&a.length>0&&(console.log(a),ue([{title:"\u57FA\u4E8E\u6570\u636E\u5E93\u9AD8\u5371\u64CD\u4F5C\u7684\u5F02\u5E38\u544A\u8B66",id:S.Z.uuid(),enableRules:a.filter(function(i){return i.enable===1}),disableRules:a.filter(function(i){return i.enable===0})}]))})},[]),c=function(){(0,B.CZ)().then(function(v){var a=v.data;q(a)})};return(0,d.useEffect)(function(){D(P),c()},[D,P]),(0,u.jsxs)("div",{className:y().rule,children:[(0,u.jsx)(U.ZP,{pagination:!1,rowKey:"id",rowSelection:!1,grid:{gutter:16,column:2},metas:{title:{dataIndex:"ruleDesc"},subTitle:{render:function(v,a){return[(0,u.jsx)(ae.Z,{color:a.isDelete===1?"#f50":"#87d068",children:a.isDelete===1?"\u5DF2\u7981\u7528":"\u542F\u7528\u4E2D"},"tag")]}},type:{dataIndex:"gmtCreate"},content:{dataIndex:"ruleDesc",render:function(v,a){return(0,u.jsxs)("div",{className:y().cardContent,children:[(0,u.jsxs)("div",{className:y().ruleDescDetail,children:["\u521B\u5EFA\u65F6\u95F4\uFF1A",a.gmtCreate]},"ruleDesc"),a.ruleName===j&&(0,u.jsxs)("div",{className:y().ruleDescDetail,children:[(0,u.jsxs)("span",{children:["\u7EDF\u8BA1\u5468\u671F\uFF08\u5929\uFF09\uFF1A",m==null?void 0:m.ruleTablePeriod," \uFF08\u8D85\u8FC7\u7EDF\u8BA1\u5468\u671F\u7684\u8BBF\u95EE\u884C\u4E3A\u5C06\u4E0D\u4F1A\u5F71\u54CD\u753B\u50CF\uFF09"]}),(0,u.jsxs)("div",{children:["\u8BBF\u95EE\u6B21\u6570\u6700\u5C0F\u9608\u503C\uFF1A",m==null?void 0:m.ruleTableCount," \uFF08\u4F4E\u4E8E\u6307\u5B9A\u6B21\u6570\u5C06\u88AB\u7B97\u4E3A\u5F02\u5E38\uFF09"]})]},j),a.ruleName===A&&(0,u.jsxs)("div",{className:y().ruleDescDetail,children:[(0,u.jsxs)("span",{children:["\u7EDF\u8BA1\u5468\u671F\uFF08\u5929\uFF09\uFF1A",m==null?void 0:m.ruleTimePeriod," \uFF08\u8D85\u8FC7\u7EDF\u8BA1\u5468\u671F\u7684\u8BBF\u95EE\u884C\u4E3A\u5C06\u4E0D\u4F1A\u5F71\u54CD\u753B\u50CF\uFF09"]}),(0,u.jsxs)("div",{children:["\u8BBF\u95EE\u9891\u7387\u6700\u5C0F\u9608\u503C \uFF1A","".concat(parseFloat(m==null?void 0:m.ruleTimeRate)*100," %")," \uFF08\u4F4E\u4E8E\u9608\u503C\u5C06\u88AB\u89C6\u4E3A\u4E0D\u5E38\u8BBF\u95EE\u7684\u6570\u636E\u8868\uFF09"]})]},A),(0,u.jsx)("div",{className:y().ruleDescDetail,children:a.ruleDescDetail},"ruleDescDetail")]})}},actions:{render:function(v,a){return[(0,u.jsx)(W.Nv,{accessible:te.canUpdate,children:(0,u.jsx)(p.Z,{danger:a.isDelete===0,size:"small",type:"link",onClick:function(){(0,B.Y3)({ruleId:a.id,isDelete:a.isDelete===0?1:0}).then(function(){return D(P)})},children:a.isDelete===1?"\u542F\u7528":"\u7981\u7528"})},"isDelete"),(0,u.jsx)(W.Nv,{accessible:te.canUpdate,children:(0,u.jsx)(p.Z,{size:"small",type:"link",onClick:function(){if(j===a.ruleName){var F;(F=O.current)===null||F===void 0||F.setInitValues("rule_table_count,rule_table_period",j)}else if(A===a.ruleName){var g;(g=O.current)===null||g===void 0||g.setInitValues("rule_time_rate,rule_time_period",A)}},children:"\u7F16\u8F91"})},"update")]}}},headerTitle:"\u753B\u50CF\u89C4\u5219\u5217\u8868",dataSource:e}),(0,u.jsx)(U.ZP,{pagination:!1,rowKey:"id",rowSelection:!1,grid:{gutter:16,column:3},metas:{title:{},type:{dataIndex:"gmtCreate"},content:{dataIndex:"ruleDesc",render:function(v,a){return(0,u.jsxs)("div",{className:y().highRisk,children:[a.enableRules.length>0&&(0,u.jsx)("h5",{className:"primary-blue-5 m-0 p-0",children:"\u5DF2\u542F\u7528\u89C4\u5219"}),(0,u.jsxs)("div",{className:y().ruleDescDetail,children:[a.enableRules.map(function(i){return(0,u.jsxs)("div",{className:"flex-x-sb",children:[(0,u.jsxs)("span",{children:[i.keyword,"\uFF08",i.description,"\uFF09"]}),(0,u.jsx)(f.Z,{size:"small",checkedChildren:"\u5F00\u542F",unCheckedChildren:"\u5173\u95ED",defaultChecked:!0,onChange:function(){var g=(0,_.Z)({},i);g.enable=0,(0,B.JH)([g]).then(function(k){var b=k.code;b===G.Gh&&D(P)})}})]},i.id)}),a.enableRules.length===0&&(0,u.jsx)("div",{children:"\u6682\u65E0..."})]}),a.enableRules.length>0&&(0,u.jsx)("h5",{className:"danger m-0 p-0 mt-5",children:"\u672A\u542F\u7528\u89C4\u5219"}),(0,u.jsxs)("div",{className:y().ruleDescDetail,children:[a.disableRules.map(function(i){return(0,u.jsxs)("div",{className:"flex-x-sb",children:[(0,u.jsxs)("span",{children:[i.keyword,"\uFF08",i.description,"\uFF09"]}),(0,u.jsx)(f.Z,{size:"small",checkedChildren:"\u5F00\u542F",unCheckedChildren:"\u5173\u95ED",onChange:function(){var g=(0,_.Z)({},i);g.enable=1,(0,B.JH)([g]).then(function(k){var b=k.code;b===G.Gh&&D(P)})}})]},i.id)}),a.disableRules.length===0&&(0,u.jsx)("div",{children:"\u6682\u65E0..."})]})]})}}},headerTitle:"\u9AD8\u5371\u64CD\u4F5C\u89C4\u5219",dataSource:ce}),(0,u.jsx)(ie,{ref:O,refresh:function(){return c()},setVisible:X,visible:oe})]})},r=$},59975:function(re,z,t){"use strict";t.d(z,{f2:function(){return C},MN:function(){return ne},yb:function(){return se},ny:function(){return Q},$D:function(){return x},Y3:function(){return G},hQ:function(){return u},CZ:function(){return j},_m:function(){return ie},MY:function(){return W},JH:function(){return y}});var E=t(11849),f=t(3182),_=t(94043),o=t.n(_),p=t(25377),fe=t(80129),ae=t.n(fe);function C(r,n){return d.apply(this,arguments)}function d(){return d=(0,f.Z)(o().mark(function r(n,l){return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,p.WY)("/api/skyflying/addUserPortraitByVisitedTableEverydayRule",(0,E.Z)({method:"GET",params:n},l||{})));case 1:case"end":return e.stop()}},r)})),d.apply(this,arguments)}function B(r){return J.apply(this,arguments)}function J(){return J=_asyncToGenerator(_regeneratorRuntime.mark(function r(n){return _regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",request("/api/skyflying/updateUserPortraitByVisitedTimeRule",_objectSpread({method:"GET"},n||{})));case 1:case"end":return s.stop()}},r)})),J.apply(this,arguments)}function ne(r,n){return N.apply(this,arguments)}function N(){return N=(0,f.Z)(o().mark(function r(n,l){return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,p.WY)("/api/skyflying/addUserPortraitByVisitedTtimeRule",(0,E.Z)({method:"GET",params:n},l||{})));case 1:case"end":return e.stop()}},r)})),N.apply(this,arguments)}function se(r,n){return I.apply(this,arguments)}function I(){return I=(0,f.Z)(o().mark(function r(n,l){return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,p.WY)("/api/skyflying/updateUserPortraitByVisitedTimeRule",(0,E.Z)({method:"GET",params:n},l||{})));case 1:case"end":return e.stop()}},r)})),I.apply(this,arguments)}function Q(r,n){return w.apply(this,arguments)}function w(){return w=(0,f.Z)(o().mark(function r(n,l){return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,p.WY)("/api/skyflying/updateUserPortraitByVisitedTableEverydayRule",(0,E.Z)({method:"GET",params:n},l||{})));case 1:case"end":return e.stop()}},r)})),w.apply(this,arguments)}function x(r,n){return Z.apply(this,arguments)}function Z(){return Z=(0,f.Z)(o().mark(function r(n,l){return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,p.WY)("/api/skyflying/getUserPortraitRules",(0,E.Z)({method:"GET",params:n},l||{})));case 1:case"end":return e.stop()}},r)})),Z.apply(this,arguments)}function G(r,n){return S.apply(this,arguments)}function S(){return S=(0,f.Z)(o().mark(function r(n,l){return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,p.WY)("/api/skyflying/updateUserPortraitRule?"+ae().stringify(n),(0,E.Z)({method:"POST"},l||{})));case 1:case"end":return e.stop()}},r)})),S.apply(this,arguments)}function u(r,n){return A.apply(this,arguments)}function A(){return A=(0,f.Z)(o().mark(function r(n,l){return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,p.WY)("/api/skyflying/config/getConfigDic",(0,E.Z)({method:"GET",params:n||{}},l||{})));case 1:case"end":return e.stop()}},r)})),A.apply(this,arguments)}function j(r){return M.apply(this,arguments)}function M(){return M=(0,f.Z)(o().mark(function r(n){return o().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",(0,p.WY)("/api/skyflying/config/getPortraitConfig",(0,E.Z)({method:"GET"},n||{})));case 1:case"end":return s.stop()}},r)})),M.apply(this,arguments)}function ie(r,n){return U.apply(this,arguments)}function U(){return U=(0,f.Z)(o().mark(function r(n,l){return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,p.WY)("/api/skyflying/config/updatePortraitConfig",(0,E.Z)({method:"PUT",data:n},l||{})));case 1:case"end":return e.stop()}},r)})),U.apply(this,arguments)}function W(r){return Y.apply(this,arguments)}function Y(){return Y=(0,f.Z)(o().mark(function r(n){return o().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",(0,p.WY)("/api/skyflying/config/getAllHighRiskOpt",(0,E.Z)({method:"GET"},n||{})));case 1:case"end":return s.stop()}},r)})),Y.apply(this,arguments)}function y(r,n){return $.apply(this,arguments)}function $(){return $=(0,f.Z)(o().mark(function r(n,l){return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,p.WY)("/api/skyflying/config/updateHighRiskOpt",(0,E.Z)({method:"PUT",data:n},l||{})));case 1:case"end":return e.stop()}},r)})),$.apply(this,arguments)}}}]);
