(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[835],{20294:function(re){re.exports={rule:"rule___2uB8V",formContent:"formContent___mfpUm",cardContent:"cardContent___ADntJ",ruleDescDetail:"ruleDescDetail___2wYEk",highRisk:"highRisk___3vyHc",enableCol:"enableCol___1VWz8"}},58541:function(re,z,t){"use strict";t.r(z),t.d(z,{default:function(){return Fe}});var C=t(13062),F=t(71230),he=t(89032),i=t(15746),E=t(77576),J=t(12028),S=t(11849),me=t(57663),U=t(71577),ve=t(71153),I=t(60331),y=t(2824),c=t(67294),D=t(59975),Q=t(74379),ae=t(38648),k=t(3182),ne=t(32059),G=t(94043),X=t.n(G),M=t(37476),_=t(64317),j=t(89460),W=t(13312),x=t(24480),e=t(85893),b="user_visited_time",Z="user_visited_table",Y="rule_table_count";function se(ie,le){var V=(0,c.useRef)(),oe=(0,c.useState)(!1),H=(0,y.Z)(oe,2),de=H[0],N=H[1],ce=(0,c.useState)({}),q=(0,y.Z)(ce,2),R=q[0],L=q[1],m=(0,c.useState)(),ee=(0,y.Z)(m,2),pe=ee[0],ue=ee[1],fe=(0,c.useState)(""),te=(0,y.Z)(fe,2),O=te[0],w=te[1];return(0,c.useImperativeHandle)(le,function(){return{setInitValues:function(T,A){L({});var B=T.split(",");(0,D.CZ)().then(function(d){ue(d.data),B.forEach(function(p){(0,D.hQ)({typeName:p}).then(function(v){var n,l,f=v.data,h=f.some(function(g){return parseFloat(g)<1}),P=[];h&&(P=f.map(function(g){return{id:x.Z.uuid(),label:"".concat(parseFloat(g)*100," %"),value:g}})),p===Y&&(h=!0,P=f.map(function(g){return{id:x.Z.uuid(),label:"".concat(parseFloat(g)," \u6B21"),value:g}})),w(A),L(function(g){return(0,S.Z)((0,S.Z)({},g),{},(0,ne.Z)({},p,h?P:f))}),N(!0),(n=V.current)===null||n===void 0||n.setFieldsValue({ruleTableCount:"".concat(d.data.ruleTableCount," \u6B21"),ruleTablePeriod:d.data.ruleTablePeriod,ruleTimeRate:"".concat(parseFloat(d==null||(l=d.data)===null||l===void 0?void 0:l.ruleTimeRate)*100," %"),ruleTimePeriod:d.data.ruleTimePeriod})})})})}}}),(0,e.jsxs)(M.Y,{title:"\u4FEE\u6539\u89C4\u5219",layout:"horizontal",formRef:V,visible:de,onVisibleChange:N,width:350,labelAlign:"right",labelCol:{span:12},modalProps:{destroyOnClose:!1,onCancel:function(){var T;(T=V.current)===null||T===void 0||T.resetFields(),ie.setVisible(!1)}},onFinish:function(){var K=(0,k.Z)(X().mark(function T(A){var B,d,p,v;return X().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:d=Object.assign(pe,A),typeof d.ruleTimeRate=="string"&&(B=d.ruleTimeRate)!==null&&B!==void 0&&B.includes("%")&&(v=(p=d.ruleTimeRate)===null||p===void 0?void 0:p.replace("%",""),d.ruleTimeRate=parseFloat(v)/100+""),delete d.id,d.ruleTableCount=parseInt(d.ruleTableCount)+"",(0,D._m)(d).then(function(f){var h=f.code;h===W.Gh&&(ae.Z.success({message:"\u63D0\u793A",description:"\u4FEE\u6539\u6210\u529F\uFF01"}),N(!1),ie.refresh())});case 5:case"end":return l.stop()}},T)}));return function(T){return K.apply(this,arguments)}}(),children:[O===Z&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(j.A.Group,{children:(0,e.jsx)(_.Z,{rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u8BBF\u95EE\u6B21\u6570\u6700\u5C0F\u9608\u503C\uFF01"}],width:"sm",name:"ruleTableCount",label:(0,e.jsx)("div",{children:"\u8BBF\u95EE\u6B21\u6570\u6700\u5C0F\u9608\u503C"}),options:R==null?void 0:R.rule_table_count,tooltip:"\u4F4E\u4E8E\u6307\u5B9A\u6B21\u6570\u5C06\u88AB\u7B97\u4E3A\u5F02\u5E38",placeholder:"\u8BF7\u8F93\u5165\u8FB9\u754C\u6B21\u6570"})}),(0,e.jsx)(j.A.Group,{children:(0,e.jsx)(_.Z,{rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u8BBF\u7EDF\u8BA1\u5468\u671F\uFF01"}],width:"sm",name:"ruleTablePeriod",label:"\u7EDF\u8BA1\u5468\u671F\uFF08\u5929\uFF09",options:R==null?void 0:R.rule_table_period,tooltip:"\u8D85\u8FC7\u7EDF\u8BA1\u5468\u671F\u7684\u8BBF\u95EE\u884C\u4E3A\u5C06\u4E0D\u4F1A\u5F71\u54CD\u753B\u50CF",placeholder:"\u8BF7\u9009\u62E9\u7EDF\u8BA1\u5468\u671F"})})]}),O===b&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(j.A.Group,{children:(0,e.jsx)(_.Z,{rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u8BBF\u95EE\u9891\u7387\u6700\u5C0F\u9608\u503C\uFF01"}],width:"sm",name:"ruleTimeRate",label:"\u8BBF\u95EE\u9891\u7387\u6700\u5C0F\u9608\u503C",options:R.rule_time_rate,tooltip:"\u4F4E\u4E8E\u9608\u503C\u5C06\u88AB\u89C6\u4E3A\u4E0D\u5E38\u8BBF\u95EE\u7684\u6570\u636E\u8868",placeholder:"\u8BF7\u8F93\u5165\u8FB9\u754C\u9891\u7387"})}),(0,e.jsx)(j.A.Group,{children:(0,e.jsx)(_.Z,{rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u8BBF\u7EDF\u8BA1\u5468\u671F\uFF01"}],width:"sm",name:"ruleTimePeriod",label:"\u7EDF\u8BA1\u5468\u671F\uFF08\u5929\uFF09",filedConfig:{},options:R.rule_time_period,tooltip:"\u8D85\u8FC7\u7EDF\u8BA1\u5468\u671F\u7684\u8BBF\u95EE\u884C\u4E3A\u5C06\u4E0D\u4F1A\u5F71\u54CD\u753B\u50CF",placeholder:"\u8BF7\u9009\u62E9\u7EDF\u8BA1\u5468\u671F"})})]})]})}var $=(0,c.forwardRef)(se),r=t(29474),a=t(25377),o=t(20294),s=t.n(o),u=function(){var le=(0,c.useState)([]),V=(0,y.Z)(le,2),oe=V[0],H=V[1],de=(0,c.useState)(!1),N=(0,y.Z)(de,2),ce=N[0],q=N[1],R=(0,c.useState)(),L=(0,y.Z)(R,2),m=L[0],ee=L[1],pe=(0,c.useState)([]),ue=(0,y.Z)(pe,2),fe=ue[0],te=ue[1],O=(0,c.useRef)(),w=(0,a.md)(),K=(0,c.useState)({pageNo:1,pageSize:20}),T=(0,y.Z)(K,1),A=T[0],B=(0,c.useCallback)(function(p){(0,D.$D)(p).then(function(v){var n=v.data;if(n){var l=JSON.parse(n),f=JSON.parse(l.rows);f.length>0?H(f):H([])}}),(0,D.MY)().then(function(v){var n=v.data;Array.isArray(n)&&n.length>0&&(console.log(n),te([{title:"\u57FA\u4E8E\u6570\u636E\u5E93\u9AD8\u5371\u64CD\u4F5C\u7684\u5F02\u5E38\u544A\u8B66",id:x.Z.uuid(),enableRules:n.filter(function(l){return l.enable===1}),disableRules:n.filter(function(l){return l.enable===0})}]))})},[]),d=function(){(0,D.CZ)().then(function(v){var n=v.data;ee(n)})};return(0,c.useEffect)(function(){B(A),d()},[B,A]),(0,e.jsxs)("div",{className:s().rule,children:[(0,e.jsx)(r.ZP,{pagination:!1,rowKey:"id",rowSelection:!1,grid:{gutter:16,column:2},metas:{title:{dataIndex:"ruleDesc"},subTitle:{render:function(v,n){return[(0,e.jsx)(I.Z,{color:n.isDelete===1?"#f50":"#87d068",children:n.isDelete===1?"\u5DF2\u7981\u7528":"\u542F\u7528\u4E2D"},"tag")]}},type:{dataIndex:"gmtCreate"},content:{dataIndex:"ruleDesc",render:function(v,n){return(0,e.jsxs)("div",{className:s().cardContent,children:[(0,e.jsxs)("div",{className:s().ruleDescDetail,children:["\u521B\u5EFA\u65F6\u95F4\uFF1A",n.gmtCreate]},"ruleDesc"),n.ruleName===Z&&(0,e.jsxs)("div",{className:s().ruleDescDetail,children:[(0,e.jsxs)("span",{children:["\u7EDF\u8BA1\u5468\u671F\uFF08\u5929\uFF09\uFF1A",m==null?void 0:m.ruleTablePeriod," \uFF08\u8D85\u8FC7\u7EDF\u8BA1\u5468\u671F\u7684\u8BBF\u95EE\u884C\u4E3A\u5C06\u4E0D\u4F1A\u5F71\u54CD\u753B\u50CF\uFF09"]}),(0,e.jsxs)("div",{children:["\u8BBF\u95EE\u6B21\u6570\u6700\u5C0F\u9608\u503C\uFF1A",m==null?void 0:m.ruleTableCount," \uFF08\u4F4E\u4E8E\u6307\u5B9A\u6B21\u6570\u5C06\u88AB\u7B97\u4E3A\u5F02\u5E38\uFF09"]})]},Z),n.ruleName===b&&(0,e.jsxs)("div",{className:s().ruleDescDetail,children:[(0,e.jsxs)("span",{children:["\u7EDF\u8BA1\u5468\u671F\uFF08\u5929\uFF09\uFF1A",m==null?void 0:m.ruleTimePeriod," \uFF08\u8D85\u8FC7\u7EDF\u8BA1\u5468\u671F\u7684\u8BBF\u95EE\u884C\u4E3A\u5C06\u4E0D\u4F1A\u5F71\u54CD\u753B\u50CF\uFF09"]}),(0,e.jsxs)("div",{children:["\u8BBF\u95EE\u9891\u7387\u6700\u5C0F\u9608\u503C \uFF1A","".concat(parseFloat(m==null?void 0:m.ruleTimeRate)*100," %")," \uFF08\u4F4E\u4E8E\u9608\u503C\u5C06\u88AB\u89C6\u4E3A\u4E0D\u5E38\u8BBF\u95EE\u7684\u6570\u636E\u8868\uFF09"]})]},b),(0,e.jsx)("div",{className:s().ruleDescDetail,children:n.ruleDescDetail},"ruleDescDetail")]})}},actions:{render:function(v,n){return[(0,e.jsx)(a.Nv,{accessible:w.canUpdate,children:(0,e.jsx)(U.Z,{danger:n.isDelete===0,size:"small",type:"link",onClick:function(){(0,D.Y3)({ruleId:n.id,isDelete:n.isDelete===0?1:0}).then(function(){return B(A)})},children:n.isDelete===1?"\u542F\u7528":"\u7981\u7528"})},"isDelete"),(0,e.jsx)(a.Nv,{accessible:w.canUpdate,children:(0,e.jsx)(U.Z,{size:"small",type:"link",onClick:function(){if(Z===n.ruleName){var f;(f=O.current)===null||f===void 0||f.setInitValues("rule_table_count,rule_table_period",Z)}else if(b===n.ruleName){var h;(h=O.current)===null||h===void 0||h.setInitValues("rule_time_rate,rule_time_period",b)}},children:"\u7F16\u8F91"})},"update")]}}},headerTitle:"\u753B\u50CF\u89C4\u5219\u5217\u8868",dataSource:oe}),(0,e.jsx)(r.ZP,{pagination:!1,rowKey:"id",rowSelection:!1,grid:{gutter:16,column:2},metas:{title:{},type:{dataIndex:"gmtCreate"},content:{dataIndex:"ruleDesc",render:function(v,n){return(0,e.jsx)("div",{className:s().highRisk,children:(0,e.jsxs)(F.Z,{children:[(0,e.jsxs)(i.Z,{span:12,className:s().enableCol,children:[n.enableRules.length>0&&(0,e.jsx)("h5",{className:"primary-blue-5 m-0 p-0",children:"\u5DF2\u542F\u7528\u89C4\u5219"}),(0,e.jsxs)("div",{className:s().ruleDescDetail,children:[n.enableRules.map(function(l){return(0,e.jsxs)("div",{className:"flex-x-sb",children:[(0,e.jsxs)("span",{className:"ellipsis",children:[l.keyword,"\uFF08",l.description,"\uFF09"]}),(0,e.jsx)("span",{style:{width:47},children:(0,e.jsx)(a.Nv,{accessible:w.canUpdate,children:(0,e.jsx)(J.Z,{size:"small",checkedChildren:"\u5F00\u542F",unCheckedChildren:"\u5173\u95ED",defaultChecked:!0,style:{width:47},onChange:function(){var h=(0,S.Z)({},l);h.enable=0,(0,D.JH)([h]).then(function(P){var g=P.code;g===W.Gh&&B(A)})}})},"isSwitch")})]},l.id)}),n.enableRules.length===0&&(0,e.jsx)("div",{children:"\u6682\u65E0..."})]})]}),(0,e.jsxs)(i.Z,{span:12,className:"pl-20",children:[n.enableRules.length>0&&(0,e.jsx)("h5",{className:"danger m-0 p-0 mt-5",children:"\u672A\u542F\u7528\u89C4\u5219"}),(0,e.jsxs)("div",{className:s().ruleDescDetail,children:[n.disableRules.map(function(l){return(0,e.jsxs)("div",{className:"flex-x-sb",children:[(0,e.jsxs)("span",{children:[l.keyword,"\uFF08",l.description,"\uFF09"]}),(0,e.jsx)("span",{style:{width:47},children:(0,e.jsx)(a.Nv,{accessible:w.canUpdate,children:(0,e.jsx)(J.Z,{size:"small",checkedChildren:"\u5F00\u542F",unCheckedChildren:"\u5173\u95ED",style:{width:47},onChange:function(){var h=(0,S.Z)({},l);h.enable=1,(0,D.JH)([h]).then(function(P){var g=P.code;g===W.Gh&&B(A)})}})},"isSwitch1")})]},l.id)}),n.disableRules.length===0&&(0,e.jsx)("div",{children:"\u6682\u65E0..."})]})]})]})})}}},headerTitle:"\u9AD8\u5371\u64CD\u4F5C\u89C4\u5219",dataSource:fe}),(0,e.jsx)($,{ref:O,refresh:function(){return d()},setVisible:q,visible:ce})]})},Fe=u},59975:function(re,z,t){"use strict";t.d(z,{f2:function(){return me},MN:function(){return y},yb:function(){return D},ny:function(){return ae},$D:function(){return ne},Y3:function(){return X},hQ:function(){return _},CZ:function(){return W},_m:function(){return e},MY:function(){return Z},JH:function(){return se}});var C=t(11849),F=t(3182),he=t(94043),i=t.n(he),E=t(25377),J=t(80129),S=t.n(J);function me(r,a){return U.apply(this,arguments)}function U(){return U=(0,F.Z)(i().mark(function r(a,o){return i().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,E.WY)("/api/skyflying/addUserPortraitByVisitedTableEverydayRule",(0,C.Z)({method:"GET",params:a},o||{})));case 1:case"end":return u.stop()}},r)})),U.apply(this,arguments)}function ve(r){return I.apply(this,arguments)}function I(){return I=_asyncToGenerator(_regeneratorRuntime.mark(function r(a){return _regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",request("/api/skyflying/updateUserPortraitByVisitedTimeRule",_objectSpread({method:"GET"},a||{})));case 1:case"end":return s.stop()}},r)})),I.apply(this,arguments)}function y(r,a){return c.apply(this,arguments)}function c(){return c=(0,F.Z)(i().mark(function r(a,o){return i().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,E.WY)("/api/skyflying/addUserPortraitByVisitedTtimeRule",(0,C.Z)({method:"GET",params:a},o||{})));case 1:case"end":return u.stop()}},r)})),c.apply(this,arguments)}function D(r,a){return Q.apply(this,arguments)}function Q(){return Q=(0,F.Z)(i().mark(function r(a,o){return i().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,E.WY)("/api/skyflying/updateUserPortraitByVisitedTimeRule",(0,C.Z)({method:"GET",params:a},o||{})));case 1:case"end":return u.stop()}},r)})),Q.apply(this,arguments)}function ae(r,a){return k.apply(this,arguments)}function k(){return k=(0,F.Z)(i().mark(function r(a,o){return i().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,E.WY)("/api/skyflying/updateUserPortraitByVisitedTableEverydayRule",(0,C.Z)({method:"GET",params:a},o||{})));case 1:case"end":return u.stop()}},r)})),k.apply(this,arguments)}function ne(r,a){return G.apply(this,arguments)}function G(){return G=(0,F.Z)(i().mark(function r(a,o){return i().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,E.WY)("/api/skyflying/getUserPortraitRules",(0,C.Z)({method:"GET",params:a},o||{})));case 1:case"end":return u.stop()}},r)})),G.apply(this,arguments)}function X(r,a){return M.apply(this,arguments)}function M(){return M=(0,F.Z)(i().mark(function r(a,o){return i().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,E.WY)("/api/skyflying/updateUserPortraitRule?"+S().stringify(a),(0,C.Z)({method:"POST"},o||{})));case 1:case"end":return u.stop()}},r)})),M.apply(this,arguments)}function _(r,a){return j.apply(this,arguments)}function j(){return j=(0,F.Z)(i().mark(function r(a,o){return i().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,E.WY)("/api/skyflying/config/getConfigDic",(0,C.Z)({method:"GET",params:a||{}},o||{})));case 1:case"end":return u.stop()}},r)})),j.apply(this,arguments)}function W(r){return x.apply(this,arguments)}function x(){return x=(0,F.Z)(i().mark(function r(a){return i().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",(0,E.WY)("/api/skyflying/config/getPortraitConfig",(0,C.Z)({method:"GET"},a||{})));case 1:case"end":return s.stop()}},r)})),x.apply(this,arguments)}function e(r,a){return b.apply(this,arguments)}function b(){return b=(0,F.Z)(i().mark(function r(a,o){return i().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,E.WY)("/api/skyflying/config/updatePortraitConfig",(0,C.Z)({method:"PUT",data:a},o||{})));case 1:case"end":return u.stop()}},r)})),b.apply(this,arguments)}function Z(r){return Y.apply(this,arguments)}function Y(){return Y=(0,F.Z)(i().mark(function r(a){return i().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",(0,E.WY)("/api/skyflying/config/getAllHighRiskOpt",(0,C.Z)({method:"GET"},a||{})));case 1:case"end":return s.stop()}},r)})),Y.apply(this,arguments)}function se(r,a){return $.apply(this,arguments)}function $(){return $=(0,F.Z)(i().mark(function r(a,o){return i().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,E.WY)("/api/skyflying/config/updateHighRiskOpt",(0,C.Z)({method:"PUT",data:a},o||{})));case 1:case"end":return u.stop()}},r)})),$.apply(this,arguments)}}}]);
